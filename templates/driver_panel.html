{% extends "base.html" %}

{% block title %}Панель Водителя{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mt-4">Панель Водителя</h1>
    
    {% if active_course %}
    <div class="card mb-4" style="border-color: var(--color-success); background-color: rgba(16, 185, 129, 0.1);">
        <div class="card-body">
            <h5 class="card-title">Активный курс</h5>
            <p class="card-text">
                <strong>Начало:</strong> {{ active_course.start_time.strftime('%d.%m.%Y %H:%M:%S') }}
            </p>
            
            <form method="POST" action="{{ url_for('end_course', course_id=active_course.id) }}" class="mt-3">
                <div class="form-group">
                    <label for="comment">Комментарий по курсу</label>
                    <textarea class="form-control" id="comment" name="comment" rows="4" placeholder="Введите комментарий..."></textarea>
                </div>
                <button type="submit" class="btn btn-danger">Закончить курс</button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Нет активного курса</h5>
            <p class="card-text">Нажмите кнопку ниже, чтобы начать новый курс.</p>
            <form method="POST" action="{{ url_for('start_course') }}">
                <button type="submit" class="btn btn-success">Начать курс</button>
            </form>
        </div>
    </div>
    {% endif %}
    
    <h2 class="mt-4">История ваших курсов</h2>
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Начало</th>
                    <th>Конец</th>
                    <th>Длительность</th>
                    <th>Комментарий</th>
                </tr>
            </thead>
            <tbody>
                {% if completed_courses %}
                    {% for course in completed_courses %}
                    <tr>
                        <td>{{ course.start_time.strftime('%d.%m.%Y %H:%M:%S') }}</td>
                        <td>{{ course.end_time.strftime('%d.%m.%Y %H:%M:%S') }}</td>
                        <td>
                            {% set duration = (course.end_time - course.start_time).total_seconds() | int %}
                            {% set hours = duration // 3600 %}
                            {% set minutes = (duration % 3600) // 60 %}
                            {{ hours }}ч {{ minutes }}м
                        </td>
                        <td>{{ course.comment or '-' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                <tr>
                    <td colspan="4" class="text-muted">История курсов отсутствует</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
